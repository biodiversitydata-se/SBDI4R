<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to SBDI4R • SBDI4R</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to SBDI4R">
<meta property="og:description" content="SBDI4R">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SBDI4R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SBDI4R.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/biodiversitydata-se/SBDI4R/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SBDI4R_files/header-attrs-2.11/header-attrs.js"></script><script src="SBDI4R_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="SBDI4R_files/jquery-1.12.4/jquery.min.js"></script><link href="SBDI4R_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="SBDI4R_files/leaflet-1.3.1/leaflet.js"></script><link href="SBDI4R_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="SBDI4R_files/proj4-2.6.2/proj4.min.js"></script><script src="SBDI4R_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="SBDI4R_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="SBDI4R_files/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="SBDI4R_files/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="SBDI4R_files/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to SBDI4R</h1>
                        <h4 class="author">Alejandro Ruete and Debora Arlt</h4>
            
            <h4 class="date">2021-10-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/biodiversitydata-se/SBDI4R/blob/master/vignettes/SBDI4R.Rmd"><code>vignettes/SBDI4R.Rmd</code></a></small>
      <div class="hidden name"><code>SBDI4R.Rmd</code></div>

    </div>

    
    
<p>Here we provide a collection of use-examples showing examples for a range of queries that we think a typical use of the biodiversity infrastructure may want to perform. The examples are extended from a basic set for ALA4R presented at the <a href="http://www.ala.org.au/blogs-news/2014-atlas-of-living-australia-science-symposium/">2014 ALA Science Symposium</a>.</p>
<p>The SBDI4R package is primarily for accessing data. It includes some filter functions that allow you to filter prior to download. It also includes some simple summary functions, and some function for some simple data exploration. The examples also show you how you can use the data by continued exploring and analyzing using other R package.</p>
<p>Please get in contact with us if you have questions regarding the use of the SBDI4R package.</p>
<div id="using-sbdi4r" class="section level2">
<h2 class="hasAnchor">
<a href="#using-sbdi4r" class="anchor"></a>Using SBDI4R</h2>
<p>Let’s assume you have already installed the package as shown in the <a href="https://biodiversitydata-se.github.io/SBDI4R">main site</a>.</p>
<p>Load the SBDI4R package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/biodiversitydata-se/SBDI4R/">SBDI4R</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/sbdi_config.html">sbdi_config</a></span><span class="op">(</span>caching <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span>
<span class="fu"><a href="../reference/sbdi_config.html">sbdi_config</a></span><span class="op">(</span>email <span class="op">=</span> <span class="st">"sbdi4r-test@biodiversitydata.se"</span>, 
            download_reason_id <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="co"># sbdi_config(cache_directory="Z:/mydir/sbdi-cache")</span></code></pre></div>
<p>Then, check that we have some additional packages that we’ll use in the examples, and install them if necessary.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">to_install</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ape"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"jpeg"</span>, <span class="st">"leaflet"</span>,<span class="st">"maps"</span>, <span class="st">"mapdata"</span>,
                <span class="st">"maptools"</span>, <span class="st">"phytools"</span>, <span class="st">"sf"</span>,  <span class="st">"tidyr"</span>, <span class="st">"vegan"</span><span class="op">)</span> <span class="co">#, "rgdal", "rgeos",</span>
<span class="va">to_install</span> <span class="op">&lt;-</span> <span class="va">to_install</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">to_install</span>, <span class="va">requireNamespace</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">to_install</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">to_install</span>, repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-1-name-searching-and-taxonomic-trees" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-name-searching-and-taxonomic-trees" class="anchor"></a>Example 1: Name searching and taxonomic trees</h2>
<p>We want to look at the taxonomy of titmice, but we don’t know what the correct scientific name is, so let’s search for it:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_fulltext.html">search_fulltext</a></span><span class="op">(</span><span class="st">"parus"</span><span class="op">)</span>
<span class="co">#&gt; [1] "https://species.biodiversitydata.se/ws/search.json?q=parus&amp;fq=idxtype%3ATAXON"</span>
<span class="va">sx</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">"name"</span>,<span class="st">"species"</span>, <span class="st">"speciesGuid"</span>, <span class="st">"rank"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;                                                    name</span>
<span class="co">#&gt; 1  Parus cinereus montanus Conrad von Baldenstein, 1827</span>
<span class="co">#&gt; 2                             Parus cela Linnaeus, 1758</span>
<span class="co">#&gt; 3                     Parus atricristatus atricristatus</span>
<span class="co">#&gt; 4                           Parus caspicus Gmelin, 1774</span>
<span class="co">#&gt; 5                     Cyanistes caeruleus x Parus major</span>
<span class="co">#&gt; 6        Parus dresseri longirostris Kleinschmidt, 1897</span>
<span class="co">#&gt; 7                     Parus major x Cyanistes caeruleus</span>
<span class="co">#&gt; 8                          Derolus parus Adlbauer, 2000</span>
<span class="co">#&gt; 9                     Parus atricristatus atricristatus</span>
<span class="co">#&gt; 10                         Derolus parus Adlbauer, 1995</span>
<span class="co">#&gt;                              species speciesGuid       rank</span>
<span class="co">#&gt; 1                               &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 2          Parus cela Linnaeus, 1758    11040059    species</span>
<span class="co">#&gt; 3                               &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 4        Parus caspicus Gmelin, 1774    11068597    species</span>
<span class="co">#&gt; 5  Cyanistes caeruleus x Parus major    10772599    species</span>
<span class="co">#&gt; 6                               &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 7  Parus major x Cyanistes caeruleus    10960118    species</span>
<span class="co">#&gt; 8       Derolus parus Adlbauer, 2000    10977720    species</span>
<span class="co">#&gt; 9                               &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 10      Derolus parus Adlbauer, 1995    10663010    species</span></code></pre></div>
<p>But we see that some non-birds are also returned, e.g. insects (<strong>Neuroctenus parus</strong>). We want to restrict the search to Paridae.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_fulltext.html">search_fulltext</a></span><span class="op">(</span><span class="st">"parus"</span>, fq <span class="op">=</span> <span class="st">"family_s:Paridae"</span><span class="op">)</span>
<span class="co">#&gt; [1] "https://species.biodiversitydata.se/ws/search.json?q=parus&amp;fq=family_s%3AParidae&amp;fq=idxtype%3ATAXON"</span>
<span class="va">sx</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">"name"</span>,<span class="st">"species"</span>, <span class="st">"speciesGuid"</span>, <span class="st">"rank"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;                                                    name</span>
<span class="co">#&gt; 1  Parus cinereus montanus Conrad von Baldenstein, 1827</span>
<span class="co">#&gt; 2                     Parus atricristatus atricristatus</span>
<span class="co">#&gt; 3                     Cyanistes caeruleus x Parus major</span>
<span class="co">#&gt; 4        Parus dresseri longirostris Kleinschmidt, 1897</span>
<span class="co">#&gt; 5                     Parus major x Cyanistes caeruleus</span>
<span class="co">#&gt; 6                     Parus atricristatus atricristatus</span>
<span class="co">#&gt; 7                          Parus aureola Linnaeus, 1758</span>
<span class="co">#&gt; 8                              Parus cyanus x caeruleus</span>
<span class="co">#&gt; 9                    Parus rufescens J.K.Townsend, 1837</span>
<span class="co">#&gt; 10                   Parus hudsonicus J.R.Forster, 1772</span>
<span class="co">#&gt;                               species speciesGuid       rank</span>
<span class="co">#&gt; 1                                &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 2                                &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 3   Cyanistes caeruleus x Parus major    10772599    species</span>
<span class="co">#&gt; 4                                &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 5   Parus major x Cyanistes caeruleus    10960118    species</span>
<span class="co">#&gt; 6                                &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 7        Parus aureola Linnaeus, 1758    10712825    species</span>
<span class="co">#&gt; 8            Parus cyanus x caeruleus    10157905    species</span>
<span class="co">#&gt; 9  Parus rufescens J.K.Townsend, 1837     2487784    species</span>
<span class="co">#&gt; 10 Parus hudsonicus J.R.Forster, 1772     2487794    species</span></code></pre></div>
<p>To restrict the query specifically to birds we can also use the ‘fq’ argument to filter the query (see <code><a href="../reference/sbdi_fields.html">sbdi_fields("general", as_is=TRUE)</a></code> for all the fields that are queryable), and increase page_size to include more records (default=10):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_fulltext.html">search_fulltext</a></span><span class="op">(</span><span class="st">"parus"</span>, fq <span class="op">=</span> <span class="st">"class_s:Aves"</span>, page_size<span class="op">=</span><span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; [1] "https://species.biodiversitydata.se/ws/search.json?q=parus&amp;fq=class_s%3AAves&amp;fq=idxtype%3ATAXON&amp;pageSize=100"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sx</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">"name"</span>,<span class="st">"species"</span>, <span class="st">"speciesGuid"</span>, <span class="st">"rank"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;                                                   name</span>
<span class="co">#&gt; 1 Parus cinereus montanus Conrad von Baldenstein, 1827</span>
<span class="co">#&gt; 2                            Parus cela Linnaeus, 1758</span>
<span class="co">#&gt; 3                    Parus atricristatus atricristatus</span>
<span class="co">#&gt; 4                          Parus caspicus Gmelin, 1774</span>
<span class="co">#&gt; 5                    Cyanistes caeruleus x Parus major</span>
<span class="co">#&gt; 6       Parus dresseri longirostris Kleinschmidt, 1897</span>
<span class="co">#&gt;                             species speciesGuid       rank</span>
<span class="co">#&gt; 1                              &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 2         Parus cela Linnaeus, 1758    11040059    species</span>
<span class="co">#&gt; 3                              &lt;NA&gt;        &lt;NA&gt; subspecies</span>
<span class="co">#&gt; 4       Parus caspicus Gmelin, 1774    11068597    species</span>
<span class="co">#&gt; 5 Cyanistes caeruleus x Parus major    10772599    species</span>
<span class="co">#&gt; 6                              &lt;NA&gt;        &lt;NA&gt; subspecies</span></code></pre></div>
<p>Now we can download the taxonomic data (note that the search is case-sensitive):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/taxinfo_download.html">taxinfo_download</a></span><span class="op">(</span><span class="st">"family_s:Paridae"</span>, 
                       fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"guid"</span>, <span class="st">"genus_s"</span>, <span class="st">"specificEpithet_s"</span>, 
                                  <span class="st">"scientificName"</span>,  <span class="st">"canonicalName_s"</span>, <span class="st">"rank"</span><span class="op">)</span>, 
                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">tx</span> <span class="op">&lt;-</span> <span class="va">tx</span><span class="op">[</span><span class="va">tx</span><span class="op">$</span><span class="va">rank</span> <span class="op">==</span> <span class="st">"species"</span> <span class="op">&amp;</span> <span class="va">tx</span><span class="op">$</span><span class="va">genusS</span> <span class="op">!=</span> <span class="st">""</span>,<span class="op">]</span> <span class="co">## restrict to species and not hybrids</span></code></pre></div>
<p>We can make a taxonomic tree plot using the <code>phytools</code> package:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools">phytools</a></span><span class="op">)</span>
<span class="co">## as.phylo requires the taxonomic columns to be factors</span>
<span class="va">tx</span><span class="op">$</span><span class="va">genusS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">tx</span><span class="op">$</span><span class="va">genusS</span><span class="op">)</span>
<span class="va">tx</span><span class="op">$</span><span class="va">scientificName</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">tx</span><span class="op">$</span><span class="va">scientificName</span><span class="op">)</span>
<span class="va">tx</span><span class="op">$</span><span class="va">canonicalNameS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">tx</span><span class="op">$</span><span class="va">canonicalNameS</span><span class="op">)</span>
<span class="co">## create phylo object of canonical name nested within Genus</span>
<span class="va">ax</span> <span class="op">&lt;-</span> <span class="fu">as.phylo</span><span class="op">(</span><span class="op">~</span><span class="va">genusS</span><span class="op">/</span><span class="va">canonicalNameS</span>, data <span class="op">=</span> <span class="va">tx</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,<span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotTree.html">plotTree</a></span><span class="op">(</span><span class="va">ax</span>, fsize <span class="op">=</span> <span class="fl">0.7</span>, ftype<span class="op">=</span><span class="st">"i"</span><span class="op">)</span> <span class="co">## plot it</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-7-1.png"><!-- --></p>
</div>
<div id="example-2-get-some-data-filter-the-search-get-quality-assertions-plotting-data-on-a-map-and-save-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-get-some-data-filter-the-search-get-quality-assertions-plotting-data-on-a-map-and-save-data" class="anchor"></a>Example 2: Get some data, filter the search, get quality assertions, plotting data on a map and save data</h2>
<p>Download occurrence data for the “Sommarlånke” and view top of the data table:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">dataResourceName</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">dataResourceID</span><span class="op">)</span></code></pre></div>
<p>Similarly, we could search by common name</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"sommarlånke"</span>, 
                 verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">dataResourceName</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">dataResourceID</span><span class="op">)</span></code></pre></div>
<p>You can also search for a set of species simultaneously (only scientific names so far)…</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Callitriche"</span>, <span class="st">"Anarrhinum"</span><span class="op">)</span>
<span class="va">fq_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"raw_name:&amp;quot;"</span>, <span class="va">taxa</span>, <span class="st">"&amp;quot;"</span><span class="op">)</span>
<span class="co"># fq_str &lt;- paste0(fq_str, collapse = " OR ")</span>
<span class="va">xbatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>fq <span class="op">=</span> <span class="va">fq_str</span>,
                      verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">xbatch</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">dataResourceName</span><span class="op">)</span>
<span class="co">#&gt; &lt; table of extent 0 &gt;</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">xbatch</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">dataResourceID</span><span class="op">)</span>
<span class="co">#&gt; &lt; table of extent 0 &gt;</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">xbatch</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">basisOfRecord</span><span class="op">)</span>
<span class="co">#&gt; &lt; table of extent 0 &gt;</span></code></pre></div>
<div id="search-filters" class="section level3">
<h3 class="hasAnchor">
<a href="#search-filters" class="anchor"></a>Search filters</h3>
<p>There are different data sources. Let’s assume you only need to see data from one source, e.g. Lund Botanical Museum (LD). LD’s identifier is “dr2” and you can directly filter the search by:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                  fq <span class="op">=</span> <span class="st">"data_resource_uid:dr2"</span>,
                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">xf</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">dataResourceName</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Lund Botanical Museum (LD) </span>
<span class="co">#&gt;                        381</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">xf</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">dataResourceID</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; dr2 </span>
<span class="co">#&gt; 381</span></code></pre></div>
<p>Otherwise, you can search available data resources, collections (and more) using the interactive function <code>pick_filter</code>. The <code>pick_filter</code> function lets you explore data collections, spatial layers. Soon there will be more indexed fields.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fq_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pick_filter.html">pick_filter</a></span><span class="op">(</span><span class="st">"resource"</span><span class="op">)</span> 
<span class="co">## follow the instructions</span>

<span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                  fq <span class="op">=</span> <span class="va">fq_str</span><span class="op">)</span></code></pre></div>
<p>In the same way you can use the spatial layers that are available to spatially search for the indexed observations.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fq_str &lt;- pick_filter("layer") </span>
<span class="co"># Follow the instructions, but here we just use the county Uppsala</span>
<span class="va">fq_str</span> <span class="op">&lt;-</span> <span class="st">"cl10097:Uppsala"</span>

<span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                  fq <span class="op">=</span> <span class="va">fq_str</span><span class="op">)</span></code></pre></div>
<p>Note that this is fundamentally different than filtering by <code>county:Uppsala</code> as this will search for the text <code>Uppsala</code> in the field <code>county</code>, rather than spatially matching the observations.</p>
</div>
<div id="other-filters-on-queries" class="section level3">
<h3 class="hasAnchor">
<a href="#other-filters-on-queries" class="anchor"></a>Other filters on queries</h3>
<p>Any search could be filtered by any indexed field (a.k.a. column or variable). You can find which are the variables that are indexed with the command `c These filter strings require SOLR syntax, see <a href="https://blog.imaginea.com/solr-query-equivalent-to-the-database-query/">SOLR</a> For example, let’s filter observations with coordinate uncertainty smaller than or equal to 100 m.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                  fq <span class="op">=</span> <span class="st">"coordinate_uncertainty:[0 TO 100]"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">xf</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">coordinateUncertaintyInMetres</span><span class="op">)</span>
<span class="co">#&gt; [1] 100 100</span></code></pre></div>
<p>One could search for observations in specific years:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># year = 2019</span>
<span class="va">x2011</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                     fq <span class="op">=</span> <span class="st">"year:2011"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x2011</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>
<span class="co">#&gt; [1] 3</span>

<span class="va">x2yr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                    fq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year:2011 OR year:2014"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x2yr</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>In the same way, one could search for observations <em>between</em> two years:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                  fq <span class="op">=</span> <span class="st">"year:[2010 TO 2020]"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">xf</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">year</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-16-1.png"><!-- --></p>
<p>Likewise, search conditions can be accumulated and will be treated as AND conditions:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                 fq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year:[2010 TO 2020]"</span>, <span class="st">"month:[06 TO 08]"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">xf</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">year</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-17-1.png"><!-- --></p>
<p>or, occurrences could be filtered by the basis of record (that is how was the observation recorded):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>, 
                  fq <span class="op">=</span> <span class="st">"basis_of_record:PreservedSpecimen"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">xf</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">basisOfRecord</span><span class="op">)</span>
<span class="co">#&gt; [1] "PreservedSpecimen"</span></code></pre></div>
</div>
<div id="quality-assertions" class="section level3">
<h3 class="hasAnchor">
<a href="#quality-assertions" class="anchor"></a>Quality assertions</h3>
<p>Data quality assertions are a suite of fields that are the result of a set of tests performed on data. We continue using the data for the Blunt-fruited Water-starwort and get a summary of the data quality assertions:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>,
                 fq <span class="op">=</span> <span class="st">"data_resource_uid:dr2"</span>,
                 verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; number of original names: 1 </span>
<span class="co">#&gt; number of taxonomically corrected names: 1 </span>
<span class="co">#&gt; number of observation records: 381 </span>
<span class="co">#&gt; number of assertions listed: 7  -- ones with flagged issues are listed below</span>
<span class="co">#&gt;  invalidCollectionDate: 7 records </span>
<span class="co">#&gt;  incompleteCollectionDate: 88 records </span>
<span class="co">#&gt;  geodeticDatumAssumedWgs84: 373 records </span>
<span class="co">#&gt;  uncertaintyInPrecision: 118 records </span>
<span class="co">#&gt;  assumedPresentOccurrenceStatus: 381 records </span>
<span class="co">#&gt;  recordedByUnparsable: 2 records </span>
<span class="co">#&gt;  firstOfMonth: 13 records</span></code></pre></div>
<p>You can see a list of all record issues using <code><a href="../reference/sbdi_fields.html">sbdi_fields("assertions")</a></code> and see what is considered as fatal quality issues.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assert</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sbdi_fields.html">sbdi_fields</a></span><span class="op">(</span><span class="st">"assertions"</span><span class="op">)</span>
<span class="va">assertFatal</span> <span class="op">&lt;-</span> <span class="va">assert</span><span class="op">[</span><span class="va">assert</span><span class="op">$</span><span class="va">isFatal</span> <span class="op">==</span> <span class="cn">TRUE</span>,<span class="st">"name"</span><span class="op">]</span>
<span class="va">wAssertInX</span> <span class="op">&lt;-</span> <span class="va">assertFatal</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>,<span class="va">assertFatal</span><span class="op">[</span><span class="va">wAssertInX</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; numeric(0)</span></code></pre></div>
</div>
<div id="plotting-data-on-a-map" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-data-on-a-map" class="anchor"></a>Plotting data on a map</h3>
<p>You can quickly plot all the observations with the function <code>ocurrence_plot()</code>, here we specify to map all ‘error’ issues:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/occurrences_plot.html">occurrences_plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"obsPlot.pdf"</span>, qa <span class="op">=</span> <span class="st">"error"</span>, 
                 grouped <span class="op">=</span> <span class="cn">FALSE</span>, taxon_level <span class="op">=</span> <span class="st">"species"</span>, 
                 pch <span class="op">=</span> <span class="st">'+'</span><span class="op">)</span></code></pre></div>
<p>Note that the plot is saved to a pdf file in the current working directory. You can find that by <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>.</p>
<!-- <img src='https://github.com/biodiversitydata-se/SBDI4R/blob/master/man/figures/obsPlot_CallitricheCophocarpa.pdf' /> -->
<p><img src="https://github.com/biodiversitydata-se/SBDI4R/raw/master/man/figures/obsPlot_CallitricheCophocarpa.png"></p>
<p>There are many other ways of producing spatial plots in R. The <code>leaflet</code> package provides a simple method of producing browser-based maps with panning, zooming, and background layers:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span>
<span class="co">## drop any records with missing lat/lon values</span>
<span class="va">x</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span>,<span class="op">]</span> 
<span class="va">xa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_assertions.html">check_assertions</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">## columns of x corresponding to a fatal assertion</span>
<span class="va">x_afcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">xa</span><span class="op">$</span><span class="va">occurColnames</span><span class="op">)</span>
<span class="co">## rows of x that have a fatal assertion</span>
<span class="va">x_afrows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>,<span class="va">x_afcols</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">any</span><span class="op">)</span>
<span class="co">## which taxonIdentificationIssue assertions are present in this data?</span>
<span class="va">these_assertions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">x_afcols</span><span class="op">]</span>
<span class="co">## make a link to the web page for each occurrence</span>
<span class="va">popup_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"&lt;a href=\"https://records.biodiversitydata.se/occurrences/"</span>,
                      <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">id</span>,<span class="st">"\"&gt;Link to occurrence record&lt;/a&gt;"</span><span class="op">)</span>
<span class="co">## colour palette</span>
<span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"FF$"</span>,<span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">heat.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">these_assertions</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">## map each data row to colour, depending on its assertions</span>
<span class="va">marker_colour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"#00FF00"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">these_assertions</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">these_assertions</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">marker_colour</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>,<span class="va">x_afcols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>
  <span class="op">}</span> 
<span class="op">}</span>

<span class="co">## blank map, with imagery background</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="op">)</span> |&gt;  
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html">addProviderTiles</a></span><span class="op">(</span><span class="st">"Esri.WorldImagery"</span><span class="op">)</span> |&gt;  
  <span class="co">## add markers</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addCircleMarkers</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">longitude</span>, <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">latitude</span>,  
                   radius <span class="op">=</span> <span class="fl">2</span>, fillOpacity <span class="op">=</span> <span class="fl">.5</span>, opacity <span class="op">=</span> <span class="fl">1</span>,
                   col <span class="op">=</span> <span class="va">marker_colour</span>, popup <span class="op">=</span> <span class="va">popup_link</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html">addLegend</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="va">pal</span>, opacity <span class="op">=</span> <span class="fl">1</span>, labels <span class="op">=</span> <span class="va">these_assertions</span><span class="op">)</span>
<span class="va">m</span></code></pre></div>
<div id="htmlwidget-f6118f35b633859883e9" style="width:864px;height:864px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-f6118f35b633859883e9">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[59.858145,57.1813784,55.8506725,55.61736,61.1179,59.858145,57.2074798,57.4648408,55.93195,55.93195,59.42363,63.91964,58.5353087,59.52814,56.71436,57.89781,59.7415207,58.0279775,59.8329597,58.15552,58.32407,57.20547,60.1537481,58.8401273,56.8797,55.5613304,58.84932,59.3942258,58.5353087,59.8298136,58.51926,57.69741,55.65685,55.59035,56.73782,55.8353339,56.47594,46.73583333,55.71679,59.43194,57.0919119,57.7044994,55.4474803,57.4648408,57.43438,56.08896,57.2677888,59.38363,58.0342258,59.23031,55.4292961,57.6672002,57.75119,58.683779,58.70653,58.73021,58.1972152,56.31028,58.4965761,56.07751,56.48371,56.3806998,56.05196,59.35808,58.63716,57.69422,55.94496,57.7044994,56.0487128,56.80766,56.07626,56.36697,59.7415207,48.305,56.8501431,58.89607,56.96588,56.4862958,57.3998644,59.3391325,61.265,59.2865181,56.5546203,55.85247,56.14363,57.93791,60.91571,56.3555018,56.86444,57.4648408,58.3864198,56.05468,56.25209,56.3806998,59.8050982,56.7889979,57.65766,55.9889279,56.3159,56.397958,56.05951,55.6729007,56.26055556,56.37623,55.8388851,62.87733,57.2677888,56.13301,59.02747,56.46281,57.4648408,47.81305556,62.5415268,57.10228,57.1488974,57.3226953,56.2056356,56.0318622,57.2713975,56.15805556,57.2451017,56.45551,56.28718,58.4082422,58.3890943,56.73274,64.0624927,56.2073925,55.99402,55.65561,55.839958,57.09152,56.8339348,62.5415268,57.2713975,57.1694153,56.68492,58.33586,56.70367,56.30048,58.88263,56.16627,56.5332939,59.2185551,57.0258164,59.57609,57.1488974,62.5749471,56.26964,56.68492,56.5332939,56.8511529,55.9244586,65.58622,59.53061,56.10509,59.0274,56.1969989,63.1786478,56.1969989,55.69487,56.1418276,57.69086,56.0352,57.95445,57.13438,56.32927,57.7007877,56.01389,64.1937921,55.40814,57.1840359,55.4005,60.4519044,57.4648408,57.65766,55.93622,56.02111,56.59095,55.9235644,57.263261,56.19864,55.9786499,48.0166,61.25833333,56.1969989,60.2615332,59.4399,56.25454,61.055,57.498246,56.7889979,59.38876,58.9987095,56.2435032,57.39648,55.51393,58.3890943,47.91138889,61.76583,61.26467,63.1786478,59.6439989,57.1694153,57.263261,55.78238,58.12135,57.5524324,57.69181,56.19228,59.38996,62.4481425,55.58055,56.6468427,56.6644303,60.19277778,56.64757,61.8613458,57.8588218,63.55777778,58.2460697,61.80025,57.4309608,63.67166667,56.85649,57.08845,57.7363716,57.9856,63.0903107,59.32157,57.65848,56.7184414,57.5896385,58.19375,58.02181,57.42078,56.48371,56.13786,56.6761,65.57932,56.3074139,56.7184414,55.97782,56.18389,60.65179,56.8562087,57.10228,64.24435,56.88286,56.11342,55.47104,56.07495,62.97733,63.10134,59.9203257,57.0426585,57.1694153,65.318342,56.10509,56.7439078,56.0212949,56.61575,57.5040182,57.96715,59.3667178,55.95662,58.96337,57.1694153,56.2073363,62.5749471,57.65848,56.01478,67.28781,56.01058,56.19883,59.46055556,56.08796,55.99726,56.10561,57.3998644,65.84444444,57.1694153,56.6252378,57.41166,48.08611111,58.75514,56.8205511,55.8481,57.78028,56.30454,58.06306,56.15297,56.19883,56.03233,58.6648587,58.228639,56.35853,56.43872,57.0426585,57.4666104,56.19864,56.02961,57.9226576,56.15297,57.0833961,60.5730938,55.9692403,56.11686,57.9942362,56.01188,59.32983,56.14808,55.97777,56.73202,65.92944444,56.1078444,57.9942362,57.79779,55.6970384,57.1226561,57.4648408,64.83722222,57.42611,59.7415207,57.60779,56.7889979,57.2713975,56.30074,56.26796,56.4458827,57.2677888,56.199,57.82204,56.77777,55.99622,55.95777,58.46537,56.046186,57.35625,58.6149776,56.20193,58.60959,56.56801,56.32547,56.03604,57.1694153,56.65046,57.899595,56.20469,57.75361,57.04269,57.2677888,57.86568,64.2675,58.2925,56.3159,56.2073363,57.0096439,65.32277778,56.12558,60.37783,56.7228591,56.84255,57.7332968,57.41674,58.39944,56.03604,58.3890943,56.0859783,56.29165,58.11698,56.27241,57.0919119],[17.6340688,13.5672624,13.6588437,13.22512,24.34091667,17.6340688,15.8543671,16.5460818,13.13141,13.13141,16.09558,19.13773,15.0383135,13.41335,14.35312,11.64914,18.6755075,14.6688755,17.7446269,12.11779,11.72141,14.06209,16.9193611,17.8419347,15.01566,14.1094052,14.79791,15.8414621,15.0383135,17.3166526,16.9113,13.10921,14.16168,13.3094,14.54113,13.2984131,14.14257,15.86944444,13.27302,13.25568,14.8246485,11.9651812,13.0840774,16.5460818,15.79877,13.74483,16.4030669,14.13917,15.8080917,17.7314,13.818618,14.9714608,14.18107,13.8126891,12.43213,15.55077,13.8772225,14.57816,12.2777639,13.9654,15.43599,14.0008115,13.95032,17.71171,15.14349,14.98373,13.94861,11.9651812,13.7186862,16.36183,13.73748,13.94719,18.6755075,16.325,14.6153093,17.51452,15.36357,13.8858051,16.2012309,18.0647083,24.03111111,16.1594892,16.1766287,14.01769,13.79179,14.60699,14.49266,14.5882434,14.95652,16.5460818,13.4387587,13.90518,14.50903,14.0008115,15.8504989,15.1329013,12.0603,13.9910719,14.60222,14.3235093,13.40761,13.552304,9.88055556,12.92466,13.9694153,14.17532,16.4030669,13.59126,15.39701,14.10319,16.5460818,16.24555556,17.8178756,14.82865,15.6641693,14.3403971,13.5897359,14.1523784,15.3925351,10.21194444,14.515515,14.46959,12.94232,14.1843534,13.8468975,14.48509,20.8614646,12.5951599,13.60563,13.20672,12.9606485,14.67625,15.39806,17.8178756,15.3925351,15.3459194,16.48404,11.95948,16.31785,12.95137,17.9841,14.38628,15.5996067,17.7701473,14.8897404,12.68481,15.6641693,17.0984041,14.55886,16.48404,15.5996067,15.0339537,13.1050295,22.27671,12.47556,14.67154,17.37656,15.6881845,14.639266,15.6881845,13.93105,13.3864438,13.12768,12.71438,15.07776,14.59503,14.13287,14.4534703,14.14557,19.7022354,12.86254,14.0482866,13.52617,15.475049,16.5460818,12.0603,13.26318,14.34029,16.41524,14.2926265,16.4507719,15.65834,13.1993882,16.45,22.35388889,15.6881845,14.9808743,13.30752,13.70851,24.37222222,12.087512,15.1329013,16.98651,16.2060876,12.8598148,16.18775,13.39658,13.8468975,13.79194444,17.03769,9.83971,14.639266,12.4750733,15.3459194,16.4507719,13.1693,13.36006,18.5339127,11.93079,15.68481,18.01397,17.407217,13.2544624,14.9151898,16.365269,21.90916667,16.18342,16.5655726,12.9314575,27.19166667,14.0173994,16.32553,15.0742064,27.52222222,14.83449,15.43551,18.6149382,15.02582,14.8197193,17.88691,14.05547,14.7250678,13.9236346,16.76208,14.52309,15.25045,15.43599,14.49833,16.24896,22.04893,13.0898616,14.7250678,13.76037,15.60925,17.36368,12.6928617,14.82865,23.82925,14.55263,13.50234,13.66587,14.12464,14.98634,17.31906,16.6017582,16.4461732,15.3459194,21.4836835,14.67154,15.9167262,14.3700545,16.166,13.7480475,15.10024,18.1572156,13.43,18.05357,15.3459194,15.0088343,17.0984041,14.05547,14.70398,20.11498,14.84569,15.64415,10.33138889,13.23277,13.90842,14.4901,16.2012309,24.15277778,15.3459194,14.3399446,15.56811,16.28416667,13.94351,12.7475519,13.39351,14.13942,15.30849,11.84967,15.33169,15.64415,13.62859,12.3407038,13.650999,13.69632,14.05834,16.4461732,14.7641624,15.65834,13.1752,15.9157124,15.33169,14.7085166,17.454873,12.8290365,13.74817,13.7857466,13.27264,18.21948,14.61664,13.363,15.43927,26.51583333,13.9162728,13.7857466,14.06657,14.0373292,16.2647262,16.5460818,25.18638889,15.19598,18.6755075,14.97386,15.1329013,15.3925351,12.79944,14.56822,16.0713426,16.4030669,14.06604,16.42783,15.85743,14.72257,13.53883,16.16071,12.6961766,16.12586,13.8158002,15.5745,15.04491,15.42969,13.99669,14.68635,15.3459194,16.14861,13.4778876,13.96264,14.99228,13.33309,16.4030669,15.2417,24.81583333,16.46944,14.60222,15.0088343,15.1069622,25.36805556,12.66833,15.91168,15.5827569,16.37849,14.2820705,15.11959,15.62733,14.68635,13.8468975,12.797322,15.48307,11.84961,15.36056,14.8246485],2,null,null,{"interactive":true,"className":"","stroke":true,"color":["#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF9900","#FFFF80","#FFFF00","#FFFF80","#FFFF80","#FFFF80","#FF9900","#FFCC00","#FFCC00","#FFFF80","#FFFF80","#FFCC00","#FF9900","#FF9900","#FFFF80","#FF9900","#FFCC00","#FFCC00","#FF9900","#FF9900","#FF9900","#FFFF80","#FF6600","#FF6600","#FF9900","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF9900","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF9900","#FFFF80","#FF9900","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FF9900","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FF9900","#FF6600","#FFFF80","#FF6600","#FF9900","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF9900","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF9900","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF9900","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF9900","#FF9900","#FFFF80","#FF9900","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF9900","#FF6600","#FFFF80","#FF9900","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FF9900","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF9900","#FF9900","#FF6600","#FF6600","#FF9900","#FF9900","#FF9900","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF9900","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FF9900","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF9900","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600"],"weight":5,"opacity":1,"fill":true,"fillColor":["#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF9900","#FFFF80","#FFFF00","#FFFF80","#FFFF80","#FFFF80","#FF9900","#FFCC00","#FFCC00","#FFFF80","#FFFF80","#FFCC00","#FF9900","#FF9900","#FFFF80","#FF9900","#FFCC00","#FFCC00","#FF9900","#FF9900","#FF9900","#FFFF80","#FF6600","#FF6600","#FF9900","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF9900","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF9900","#FFFF80","#FF9900","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FF9900","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FF9900","#FF6600","#FFFF80","#FF6600","#FF9900","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF9900","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF9900","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF9900","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF9900","#FF9900","#FFFF80","#FF9900","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF9900","#FF6600","#FFFF80","#FF9900","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FF9900","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF9900","#FF9900","#FF6600","#FF6600","#FF9900","#FF9900","#FF9900","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF9900","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FF9900","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FFFF80","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF9900","#FFFF80","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FF6600","#FF6600","#FF9900","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600","#FFFF80","#FF6600","#FF6600"],"fillOpacity":0.5},null,null,["<a href=\"https://records.biodiversitydata.se/occurrences/f63d6db2-6908-43f0-b53b-91dc72cd0afb\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/cbd6877e-de6a-4fb8-98cb-00f94ccad5ee\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bfb24604-fca6-4f37-9234-835000c9aee9\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6a6e2fc4-c229-4385-b474-9995073efb7b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/58bdeb15-82b8-47ac-98be-0d74b798fcd7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/335cd49b-4091-42fe-a594-7bd022653a95\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2e2305c0-257b-49b6-ab30-ac5473773275\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/15da2df1-62f3-4d66-a7a0-d677b81ed570\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/33e29d36-414a-4643-b1e6-a44d38ce8774\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0176dd10-73e8-473b-8738-aef679ecae2a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f11e13bf-ef4f-4677-8552-448ac9a640fa\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/cf617f99-c1b7-41d8-80a6-9285f6b8a0cc\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c953c8db-5744-4eba-9e67-8bb5da50655c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c7904caa-381d-420d-9266-0dc461a6e232\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/be198ffa-76de-43ce-8384-0e2e5cf05a2a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bc993d02-0f44-4309-91a4-7db0d900480d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b717fc31-58fa-4410-875c-bc60b7c8ad48\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b361e18a-3419-40d7-9a2d-202b80f6d5f7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a525313c-e92a-4192-9812-b2aef189a410\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a0fddd9a-65f2-4623-9eb3-b3afc48c02f4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7d381d86-1790-4321-b5ff-a583477fc873\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7616a0f5-257d-4022-841d-21b7dc13fe14\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5e33494e-6f8b-4576-8c7d-d44060dc018a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5736cb90-51de-4060-8217-c028bd19ee99\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4e05bb7d-eec6-4ee4-bb77-b069c58df372\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/466007c3-27b2-423b-a542-faf33f9922d5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/384dae14-eaf0-4b12-8248-42f646d19a23\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/27f299ac-a492-430b-87b9-175f02865cee\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/154993a5-02b2-47c6-ba4e-a4154e5b3702\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0de640ae-833d-44b1-9892-c249be15baf7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0cf95db9-0290-4a92-9eb1-05d5e506fbad\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/03eebc8a-e192-41c8-8ba1-8b942c706d10\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f66ec39c-8cf8-451e-b59e-336247a1ca32\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ec6d2bc7-43a6-46e5-822b-1e83b2b80094\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e5f2b5e3-a410-4ac8-be8c-12fb02096019\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e3fc5199-40df-4c27-be53-a078d37f3a4e\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ca2a6956-0b51-4c3b-8a53-7b7045f84989\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c05b494b-adc4-4771-9a1b-680c1d8881e0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b11effcb-a923-40e1-acb7-01c3d12badb7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/84178b0f-47a7-45eb-8e4d-b624d7df5569\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fdcee417-e439-4c0b-8e16-33b481c99966\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fc9441cf-56ef-4d09-8480-06b2635c95af\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f4f475c3-ba94-4c4c-a5f7-d6430eb3cf06\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f00e555a-5741-4119-91bc-1802c814638b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/eeadaba1-78b1-4238-9e0b-005d33533b6e\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ecf4ae03-d39b-46a1-b311-bbb8edd2a951\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ebd78f18-4dd8-4ba4-b1d1-9434dcc84860\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/eb98dde7-6e22-41f7-913e-b8d63c31441d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/eb35ff70-8e19-4cfa-9923-de2c0f7dd08c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e97395e3-6ffd-4f6f-bf87-1dbcf235bafa\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e47e5024-ce86-43a0-8a59-758bab8a95e5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e2ee3bc2-2762-4ce7-8642-56cf515820c4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e2df2c1a-6e03-434e-92a3-d707b3ee3976\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d2451ae1-d932-449e-82d4-f3fdce121ca3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d1e934dd-73cb-429a-96c5-a80b687a0123\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/cb252617-f2a4-47de-9951-6d7957d405f2\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/cb14b05d-4724-4d64-9754-d529253d77cc\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c8bf68e6-724d-482b-88be-4211529e2a60\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c1d98b74-1830-48d6-a287-a4bf53b63080\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bbff6d2b-b7d4-488a-ac0c-c6b8cbdf6e2c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bab4903a-17c0-4a52-9c69-24eb696f4fbc\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b8cfd9d7-eb8c-47ff-8622-db505b5a78e0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/aea59f8f-5dce-4059-8648-0b06b329c0be\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ac101f5b-a35e-4329-a07b-a61410490341\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/aa41b4ea-ac4f-4786-8cec-710979123206\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a3e74ca1-9428-40d1-8ffe-4b08f60520e3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9e183e8f-3c1f-4b90-b8ea-7f1759e1fb1b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9bd4120c-3de0-44e1-bb4d-fc37e66b8488\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9add5317-a4df-44df-ba40-f06cef79c181\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9a0aa1de-1774-47e3-af51-54bbc1086e11\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9918f251-9d7d-4372-abf3-e671d2b2a2f4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/97765636-511e-4079-8c6a-f106f8224da2\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/949c2c90-4818-4217-b423-5698e7da6e67\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/94985d81-8b4e-413f-a46d-fe1926b554ad\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/913510cc-241d-4dac-a422-41cd756a1aab\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8ebc0a11-e58f-45bb-9896-5c0b642c7fef\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/868949ea-71dd-4e1e-9fd7-6ca62d2865a1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/85b5f5d0-69bf-45d3-b07d-acd19f90da8c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7ea15043-a826-484d-bf5e-92ea907d2938\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7b1950e5-cc06-4550-8c03-fe1dd4c4c0cd\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/79ef3b74-6001-42de-81b1-90ef38bf29a5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/791c337a-a0be-47e6-bee8-7d89ab0c1907\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/789232be-a5c1-4fa1-b5ad-0dbb65b23be2\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7868989f-4cde-48f5-ba18-5f1b60240156\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/777ee8ee-719d-4e25-8570-8b52391e7533\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7543de0f-d913-4b54-8b4f-7e4f5ce5662d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6a367d54-03db-4521-8c6d-a8753807f3f8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6967f8ce-2ce6-430c-988c-394057c6f7c1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/68d4bb8b-08a9-4753-80bc-5dab190fcf44\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/65e4e5d5-6eee-4615-bbb9-4c536d3a0795\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/64df123a-3389-4444-b131-96a7dc1219b8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/62b6ae4f-d92d-48f2-b5d9-b60e78e6b06a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5d6aba36-91d2-483c-805d-d00669b80d01\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5c8b65e5-2e17-4766-a136-4b6a8910ed9e\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5abd2867-c58c-4dc2-ac50-50f73857f183\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4faddaed-667a-4bb1-bd42-c7abd7f8a8aa\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/482f4686-4bd4-4585-9d32-4603f635bca3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/43d7f423-bd4c-4da7-b3c8-68ee379dc772\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3e4d52d7-497a-4db0-8298-d63197a4551c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3ba2ac3d-3866-4751-b5ef-e4d3a8443f94\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/38c8db6b-cfad-4d7c-91d7-9c388651f4c4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/388ec28b-b199-43a8-9876-4fb9a18a0d91\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2dc8808b-7073-4f77-b13a-5a4ee2a0dac7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/26b0eb21-69b4-4e84-8bcd-5facd90979b6\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/23acc0d2-e72a-4b82-92f0-bbdad803e431\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/20b89d66-71c2-4ea0-a1f3-2c625edd3976\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/19c73bb7-6361-46e1-9843-1cb9e9924253\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/1248917c-907c-423a-a701-382472dca11c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/117202f7-3750-4967-94e9-cddecedb5384\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0dbbd78d-a14d-43e5-ae0b-ea871b476524\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/05c030b4-2d09-4816-ae5f-3276d3a380c9\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0259e13a-5079-4b9d-b3b8-fe840aa17f83\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fef5e62e-4367-47eb-b3db-6e9cb89f3308\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f65b601a-a068-4069-ad67-1b9c458cc0f3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ee5a7ff8-1203-44ad-9b43-2f79e16f19b6\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e4963011-e80c-4ede-85f5-9bca95325e6b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d891533f-7c81-443c-8cba-c3f734892bb0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d119e136-a4ab-4c17-8eb9-906a989cbef4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/cdc3cf7f-b298-4fcf-92db-43c485ef4bc7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c51a97e3-e184-4512-81eb-177b4d8b22ec\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c2523ed8-d331-4ebc-9474-6c77303b20dc\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bd4dc601-8e5c-4552-8944-853904640070\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bc21afe1-7f1f-417f-aef6-7257bc88bb9f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ba385956-4185-4405-b7dc-5c28c08ae974\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a3bfa672-849c-4720-8850-e46d236cd437\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a2148079-a0fa-4572-941d-b266996a09e4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9d1a0c46-c53f-4c25-9b12-ddda661db50c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9c29185c-05a8-4b46-bd08-d539c0e430d5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/91cd6f3c-1d3f-4c3d-a354-4e6757af6481\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8af31e3b-90f3-4aba-b38b-ccb7d67c5a99\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/83fe8a99-2146-47d3-a34d-ae1882d5d295\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7fce2dd2-afc3-4329-8d93-67e08617fe91\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7cafdbdc-9bf5-4651-b13f-b9af1c077970\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7c011031-c8aa-4271-8b74-7a0d4a413aa9\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/78b3fc99-ef99-4c79-a2ce-d1b3868b04dc\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/754ebd7c-bcd1-4498-af41-ebbcd1b4bdab\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/72d8c29c-8415-4178-9be6-54f4ab415ec6\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5f729650-3715-4210-869d-64798afa8ac7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5dd1a726-f880-477e-881c-8d7f6abec73e\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/58e3a86e-8b14-4f40-a711-f8e75f5e2a38\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/58cee2b1-93e4-466b-8453-fe18df773bd0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/577f6e67-f207-4eeb-8867-ab8dbdb4fe05\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4b239627-89dc-4d27-805a-5b41e83d0822\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/49970156-c9b7-4753-b36d-5026e7300cbf\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/41bdae18-4bed-4483-af2d-a80140df3608\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3d09086b-46bc-47d4-83f4-b9e083d2fa81\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/385ec563-35c0-4857-92ce-80999f229ae6\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3645c4bf-0806-4121-a924-a15ede7704d9\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/31289c54-531c-4215-8d3d-4733f3403772\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2d6d1402-f818-48bd-8d82-0ddd85b7507b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ff146285-f6be-4a32-9b7e-dfbe6ba4a99d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fbbb08b2-d880-46ab-b555-8ef96235c441\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fbaafac8-4a8c-47bc-85eb-10672343ad4a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fada47ea-0f36-4672-b3ee-73c67322961d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f5bafd0f-6a93-4c46-bee2-d5dc327d6d78\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f559b6cd-c18e-4f49-a922-fb8b761fea08\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f39f5ed6-e691-40dc-bf6d-6b4d7859078f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f02d398a-6d42-4c08-bf80-043530ab0534\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ef471041-b4c6-4220-9442-9b2926e34789\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/eb408ed1-087b-4e86-b416-9c55be945f9b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e6a38dc7-8677-45f0-adbd-6047408802d9\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e43670f2-5164-4974-95d9-293e2ab62f37\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e3e6dbff-bd0a-401f-a904-244faab5265d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e1a6fd98-347d-4d74-8c5b-877cdfc6cec0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d9fb1373-8e31-47a3-a20d-52600e94f2d1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d9155c86-8c79-4b02-9240-cc9d8afe306f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d712a17f-a167-4a26-b323-9b065617846c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d597382c-e27d-4d17-a340-678b42ae0fac\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d4b6c4d7-dd73-460c-bc57-11db7e919037\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d220655e-b589-4e28-b11a-e40c1049bed4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/d1680ea9-1750-4a48-bd15-e74ebd848feb\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ce7407ec-6515-484a-927f-4ec04763eb20\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c5328cef-56e5-46d3-9f31-ff6db5bc81d6\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c50a89f8-5059-47f9-ab12-0b6e3504747e\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c100542b-4cc5-4290-8719-cc9631162809\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bde6cfb6-b0c6-4cad-b8ec-f05348b5483c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bb88fbdc-7d65-4374-a081-7a09ae264ede\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/baaff9fe-2e2a-4f54-b02e-1e027c497180\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b9568f28-65ba-43cb-965d-401b6ff8eda4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b7443baa-1e72-43fc-9d67-e03821518614\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b720cba4-a8cf-42f2-8e25-3952b77578e1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b5e87b2a-7045-4e02-9e7f-a758fddfd9ba\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b57dd7e9-c383-4229-a9c9-91ab2c86a90a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b394a52e-a295-4054-9448-130e128f0d10\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b3693ce0-1ee8-4412-a8d3-d56aea51a79f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/aca18289-b864-4306-aeb3-c71d1d34f819\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ac1d2474-9fc3-4865-a673-76be46ad3717\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/aa722b6c-2723-4863-8b35-775f7f19376a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a9f45263-3f64-4985-9164-8e609826db8b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a7e329c4-dbb2-42a9-83e8-c245b78e2356\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a4740dcb-004a-4bd2-ab4a-86943e63c943\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9fcb839a-e6af-4837-a7e3-b9b87d0a142c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9c25c386-e587-444d-8b21-802a9f11afc4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9b891da2-7df4-479c-b13d-1b347b236b3c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9ada30f4-7436-46b9-a067-e6072dbb3c7f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/99076de7-b809-41f8-9ca2-a27986a931f3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/96dbc98f-278f-451b-b4c7-7630eb6708d6\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9436acb4-2a7b-4345-98d8-52a0a333aaf8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8eb43992-a17d-4ad2-99a5-1e627a0e8d89\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8e9accc8-8873-4c18-8871-0d357ffb2f7c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8de9cce3-9a51-480b-b347-24ea4be1a7ab\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/89f83f2e-a1f3-4fc2-817d-64b2d39c1e43\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/88c1f9f4-bded-4fea-ba8a-998a18792593\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/865ea25d-59d4-46e1-b460-ff483ddb9dab\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/84910894-be03-4479-ba0d-eade798aaa8a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/83178704-c09a-4aab-9ce8-1ba05ebab5a5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/80cc8603-ace0-4a84-a469-d4a5b0eb9bc1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/80b515a7-6b77-4ada-be97-5f1fc031c058\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7f829a3d-cb52-4ef8-9923-f142ce52fac0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7d310c03-cc4b-4836-a807-23b7eaa03376\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7a6c610d-4daa-4317-bb6c-91d869b4fde8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7a11b571-e728-4018-9344-123c732196f5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/79ea77f0-c9f8-4b75-8414-410749e15cbb\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/78c9331f-b61f-4604-8c42-6879295f4676\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/787b2a88-9ece-46ab-84a7-1be4a2ec2e76\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/75c5bdda-bb6f-4180-aa3b-f4d54bcc9007\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/73fa41af-e701-4916-bd2b-558034c522e5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6e0e0a3b-da8c-4ea4-8dd8-4430a6e81f66\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6dc79b8a-403b-49d9-a33b-c664458fbc70\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6bf76b96-40af-428d-a493-c22f981b050d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/69e32a48-cafc-4cdb-b929-93582bef1223\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6401e393-4a50-4cf0-aefc-7181225941a8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6192a81d-80c5-4f05-b9e5-7d7bc8222a89\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5deaa99c-5763-4e5e-b502-cc60ee343799\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5d21f79b-b3ed-4acc-92c8-92d7d6312b4b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5b0b7871-1e46-46ce-a84f-1f9616d4a0ed\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/59848dee-dfea-4ccb-9a2a-c1e1bf873016\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/58a97a8a-440a-4c0a-acff-2440c082c6b8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/56f92d63-814f-4f10-b7cf-58d5aa35dc4d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/53de9913-7c7d-4139-943d-d38235413241\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5394bbf8-3caa-459e-9b2f-ce96ba42a21d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/508e0db1-32a3-46b2-bc5c-6c6ad1d4d63d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4d73b364-337d-4841-ab98-2ca7939cddb8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4d680cf1-965b-49ff-a159-2d45d714bf51\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4a949f2d-69b1-48b1-843b-8e89b7909c62\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/42d8f14a-b025-4f79-95e1-f693ba5715f0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4167d15f-4168-4f30-beea-6da7481cce90\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/41522360-9a0d-4748-82a1-6970e18f4eea\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3eaddddb-2cc5-4d68-b0c1-4ebfd61228b8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3b3b579b-d8ec-490b-902d-cae901d50e6b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/37fe3eb1-2623-4f84-a12d-acd695ebc683\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/37bb70d2-083f-4a37-8bc3-f552f25f43e8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/37b66e03-28c0-4b86-a33a-da3a53e7a215\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3775ccaf-e0a1-4082-ac43-c13d24141552\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/369c44f2-cf3f-486e-be5f-90b7fa63c8a4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2f3c4ef5-5473-4964-a00a-5d0846c55154\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2e96af9b-83f1-4f13-8d15-8b91275723e7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2c91f6ca-7f39-44df-8658-17fb266a392d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2c6e078d-8148-4555-9748-5899946879a5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/285d431f-30c7-495f-a607-8c8aeaca4927\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/25a9c61e-06c1-4f1d-9d1d-2315749e8183\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/22f6d1b4-79cc-4220-98ff-33152a66e92c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2159a1d4-a3c5-4a46-9aa5-37224cb09009\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/1f817726-0aa4-4831-81da-d051b1344704\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/1d3b0da3-b619-4a77-a3a0-211ec67b0af6\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/182823f8-06a5-4c57-bbc4-5021d59e5c1a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/176728e1-4e05-40d8-89bb-ae617449ce6a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/1593c235-d9c8-423b-b63b-9ecf9a7a12aa\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/10c1bb8f-3ddd-4bcc-b756-149f5e3a5bf5\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/10036b2e-ea4e-4c10-81ea-6a357cf8e9fc\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0e8708f3-e878-413c-ade6-8700ac36e52a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0910a661-ae79-4234-9c00-fa3e0cf96bf3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/03cc4f96-5b78-4d02-94aa-4fbe1cca0a5e\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fd7ed90b-52f5-4609-9de9-b3b224f9237d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fd522146-e27a-4ab9-9e12-5a786de543b8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fc70b854-70a0-476d-a0d4-5db7afc88acf\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fa3e1e64-3edc-491b-9b5c-3da51b877c29\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/fa3e0926-fb02-4b37-88f4-7809fb145785\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f8f543c5-ff05-40e1-b637-488bf4185ab1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f5321323-d114-40f1-9ced-fe19b12ebc6c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f3f62b82-ccb5-459e-b6af-56ac5a6352f9\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/f0e5c0a7-80c9-4ab8-8b49-5d36c1bbf589\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e97af08a-729d-4856-92ec-658da1940e8b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e700a46f-e313-41d0-a443-7bcd1f5baf83\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e65fad1e-ec05-4f10-add3-f820c2c55366\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/e5d6bb1c-f502-42ff-9dc4-443c2f37af7a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/dc7981f0-25d1-4d85-895f-8a6ddfc8858c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/dc524cd9-dec4-477f-9b5a-04b957a834ab\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/dbecf186-b0e0-42db-b2d5-945d69b0f973\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/db9803b4-e246-465b-aa34-fea839838efe\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ced27a4f-b64d-474c-970f-8fbc97cd9ae2\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/cc08ba0e-d71c-4a7a-a085-e9d6dcb8eccf\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c92d6c80-85ef-4952-9761-c1fc8eac6f35\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c856aae1-1b93-43f2-9ca2-9d024a7b9447\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c47bb327-064c-4fa6-bb82-35599e970377\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/c3529aeb-e9ec-4b9b-9a9d-ba2b2b889896\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/bc53655d-c631-4015-94af-08278c34c802\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ba662a67-443d-4a52-82ab-38e9b1b2aa45\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/ba2f7dc3-72d7-44ad-b754-6cb20995d0d1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b9aa2797-791e-4df9-814d-9cbfb1b2ae65\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b55a3d02-468d-4be8-a9dc-1ae10570e54f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b0d8b213-3e3b-47e1-8e8b-1a766566a964\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/b0937d57-f39f-4970-a707-08facd645a0f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/af77755a-5988-4eee-b091-7a112b91546d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/af763732-65fd-49a7-bee4-6d074c8262fa\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/adf560c9-bd58-4bef-a704-9803437d5447\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a715f55c-5ff0-4b3d-96dd-99bb85986a3c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/a27bf3ee-80b2-4638-b758-0643adb24ec0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9ca3b9b2-b3d9-4bf7-97c7-075ce5ee2031\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/97e7c92d-9d2b-4d69-a095-d39d321266ac\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/97243ae5-aa48-4622-9612-bf07884371bb\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/96e2d45b-502c-4e58-b829-4d06b4fa83c7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/961ed1b4-a02d-49d9-b659-58a61de628ed\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/9116f913-700f-4cf4-9043-07f6b225f44c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8ff9d809-d20f-4353-a03a-cb8d8ce1d162\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8d8435f1-c33c-49ad-8c0d-b7231058db17\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8b768478-9d10-430a-9dff-5791a64c59f2\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/8b3186ae-63f3-4886-b696-4d1a5d7454cc\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/87eef71a-0abd-4e0e-8a63-36795f43bf6d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/83c22ea8-1887-4998-af6a-ca607d741e8a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/83a6f912-f85d-4dc9-b034-3e1824269cc8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7df9e583-0b6e-4ad5-a460-9397bae846c6\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7dafae94-d4ef-4bf4-ba08-60e82d6c7d7b\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/77ccd385-307a-4154-b364-1c36f3cfd31e\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/74481bc3-5219-4f4d-b636-933f9c146cfd\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/742e58b8-ccfd-4f6d-bbc7-7ec801d221b0\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/73aba32c-23da-4845-8535-613e833db0a2\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/7188154a-a3eb-4f36-ace6-4405dd84ee29\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/710f8d17-efda-4d12-a3da-af0f3ec3e485\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6fbb1299-5b27-49d9-84f9-0428c0702c5d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6e5c2f65-3460-4673-9175-499e5f9b84a4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6a262a86-aab0-471b-8b21-8b622bae3dc1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/6898b356-a7cd-440c-ad85-8621c119c6af\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/65812f36-7634-43b2-bd0f-56198a68f4cb\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/60f08f5a-91db-47ea-8853-005768c5c556\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5f08a2aa-ea93-47c8-a02e-6c8642e8f679\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/5af71a17-6d2f-4a10-b73d-138e97ba9909\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/590d02d6-724e-4a27-b633-a020f4496545\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/583f0254-79df-49a5-a084-a05508052e46\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/54543b31-0f96-4f8f-a440-b5670f8a5c74\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4f8c7fdf-024e-45d1-b548-35ab931d4e23\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4eea4329-3974-4b76-a588-d64dd8da0604\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4d7161d3-90e5-4211-b676-fc23cb809e3c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4c7af639-f289-4f23-8a9b-b575f2a7e552\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/49bd7d85-cdb2-4c90-ac17-bd2c231422d7\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/46bb48fe-0eef-403a-a1d0-c2cfe77d28a1\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/45811fec-effb-4c4b-8359-dcaa02172da3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/44b0788c-448b-499d-be63-f89173650042\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/4351e35b-5eac-407b-ab25-df5fbc4a8e8a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/42c2a7ed-eea0-4961-bcdf-9f5cd94e8f7c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3a54cd77-37b1-4aec-9a17-a54f9b96121c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3908f345-7a9a-4b94-8d78-9082552e841d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/383708c2-41e8-4273-a44b-65c48fc86704\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/37273a8e-e0e6-4a04-b31d-41d807426043\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/34f9c0ff-aa63-4bd8-8247-832f063e0379\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/34c0a3ef-c766-4e16-a368-8eabb0b5051f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/341992ed-6216-4fd9-83e7-5fbc7f1ee872\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/33f0cfd9-ff5c-44c2-853a-a8b1daa532ef\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/3329673c-29a2-4f6e-91b7-a89c8e9c4cda\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2cb58ecc-4103-450b-9170-e68d758ab198\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2cafc4fa-a482-499f-8fa1-531217e65664\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/2c7362a3-653b-41b3-99c6-095ad4ebe53c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/28f81819-3b45-46c9-b3d6-d45ee2e4cbb4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/27d91dfb-3e9a-4229-b3b6-a500c35edc4d\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/232b8c60-1a58-4672-8055-c144f6cb4170\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/20226591-d811-4078-8517-e6a9f93ad4d3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/1eab4ae3-0b19-44ed-a726-7b9ffb47b64e\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/1cf37daa-b72e-4782-b90e-45328ac98c80\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/1621426e-d286-4ad6-8704-be9abd49527c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/150738c8-efaf-4901-aac3-48c5bfc05f55\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/1500160d-f359-41f8-aeff-918001d8d0ba\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/14bb95d7-7401-4021-974e-61d4b3dae6c8\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/141d5616-9758-41be-b0e7-daa89407dd40\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0ff2e5dc-36b1-4868-a3d7-fa5bece9faa2\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0f022fe8-39c1-4617-bfc9-6ef9ffc97713\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0e2f36ba-a982-412e-86d3-931a9b5ab97f\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0cf2b22f-63c3-4889-a4fd-aa1b94540bb4\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/0b059053-620d-43be-9664-da22c3b1743c\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/082a06ec-fa8f-447f-8472-2615b076edd3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/07c3fb5d-ef88-46e8-bbc3-a217cd710e3a\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/07b56f9f-e7d2-41e7-9859-3bbf9e3b3ce3\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/053b1c7c-a408-4e18-a011-051535137381\">Link to occurrence record<\/a>","<a href=\"https://records.biodiversitydata.se/occurrences/03ea9707-79f7-4975-a9ef-1814b8aa200d\">Link to occurrence record<\/a>"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#FF0000","#FF3300","#FF6600","#FF9900","#FFCC00","#FFFF00","#FFFF80"],"labels":["assumedPresentOccurrenceStatus","firstOfMonth","geodeticDatumAssumedWgs84","incompleteCollectionDate","invalidCollectionDate","recordedByUnparsable","uncertaintyInPrecision"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"unknown","title":null,"extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[46.73583333,67.28781],"lng":[9.83971,27.52222222]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="save-data" class="section level3">
<h3 class="hasAnchor">
<a href="#save-data" class="anchor"></a>Save data</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save as data.frame</span>
<span class="va">Callitriche</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>

<span class="co"># simplyfy data frame</span>
<span class="va">calli</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Callitriche</span><span class="op">$</span><span class="va">scientificName</span>,
                    <span class="va">Callitriche</span><span class="op">$</span><span class="va">latitude</span>,
                    <span class="va">Callitriche</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span>
<span class="co"># simplify column names</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">calli</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"latitude"</span>,<span class="st">"longitude"</span><span class="op">)</span>
<span class="co"># remove rows with missing values (NAs)</span>
<span class="va">calli</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">calli</span><span class="op">)</span>

<span class="co"># save new dataframe</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">calli</span>,<span class="st">"Callitriche.csv"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="example-3-summarise-occurrences-over-a-defined-grid" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3-summarise-occurrences-over-a-defined-grid" class="anchor"></a>Example 3: Summarise occurrences over a defined grid</h2>
<p>Now, following with the data downloaded in the previous example, we want to summarise occurrences over a defined grid instead of plotting every observation point. First we need to overlay the observations with the grid. In this case, the standard Swedish grids at 50, 25, 10 and 5 km are provided as data (with Coordinate Reference System = WGS84, EPSG:4326).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon <span class="op">=</span> <span class="st">"Callitriche cophocarpa"</span>,
                 fq <span class="op">=</span> <span class="st">"data_resource_uid:dr2"</span>, 
                 verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="co"># load some shapes over Sweden</span>
<span class="co"># Political borders</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"swe_wgs84"</span>, package<span class="op">=</span><span class="st">"SBDI4R"</span>, envir<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> 
<span class="co"># A standard 50km grid</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"Sweden_Grid_50km_Wgs84"</span>, package<span class="op">=</span><span class="st">"SBDI4R"</span>, envir<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> 

<span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">Sweden_Grid_50km_Wgs84</span>
<span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">grid</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">3006</span><span class="op">)</span><span class="op">)</span>

<span class="co"># make the observations spatial</span>
<span class="co"># NOTE: make sure there are no NAs on either column defining the coordinates </span>
<span class="co"># see example 2 for cleaning your dataset.</span>
<span class="va">wNAcoor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span><span class="op">)</span>

<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">wNAcoor</span>,<span class="op">]</span>, 
                coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>,<span class="st">"latitude"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">obs</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span>

<span class="va">nObs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>

<span class="co">## overlay the data with the grid</span>
<span class="va">listGrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span><span class="va">grid</span>, <span class="va">obs</span><span class="op">)</span>

<span class="va">ObsInGridList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">listGrid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">listGrid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">ObsInGridList</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">ObsInGridList</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">obs</span><span class="op">[</span><span class="va">listGrid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">wNonEmpty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ObsInGridList</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">wNonEmpty</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Observations don't overlap any grid cell."</span><span class="op">)</span>

<span class="co">## check nObs</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ObsInGridList</span>, <span class="va">nrow</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="va">nObs</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ObsInGridList</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>The result <code>ObsInGridList</code> is a <code>list</code> object with a subset of the data on each grid.</p>
<div id="summarise" class="section level3">
<h3 class="hasAnchor">
<a href="#summarise" class="anchor"></a>Summarise</h3>
<p>Now summarise occurrences within grid cells:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## apply a summary over the grid</span>
<span class="va">nCells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ObsInGridList</span><span class="op">)</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"nObs"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nCells</span><span class="op">)</span><span class="op">)</span>,
                  <span class="st">"nYears"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nCells</span><span class="op">)</span><span class="op">)</span>,
                  row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>,
                  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">cols2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scientificName"</span>, <span class="st">"year"</span><span class="op">)</span>

<span class="va">dataRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ObsInGridList</span><span class="op">[</span><span class="va">wNonEmpty</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="va">cols2use</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scientificName"</span>, <span class="st">"year"</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nObs"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="st">"scientificName"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
           <span class="st">"nYears"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="st">"year"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">dataRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">dataRes</span>, .id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>

<span class="va">res</span><span class="op">[</span><span class="va">wNonEmpty</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dataRes</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">res</span><span class="op">$</span><span class="va">nObs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">nObs</span><span class="op">)</span>
<span class="va">resSf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">$</span><span class="va">id</span></code></pre></div>
</div>
<div id="plotting-data-on-a-map-1" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-data-on-a-map-1" class="anchor"></a>Plotting data on a map</h3>
<p>Finally plot the grid summary as a map:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">palBW</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"navyblue"</span><span class="op">)</span>,
                               domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">nObs</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, 
                               na.color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>
<span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="fu">palBW</span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">nObs</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">swe</span><span class="op">$</span><span class="va">Border</span>, border <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, 
       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">nObs</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
       col <span class="op">=</span> <span class="fu">palBW</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">nObs</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
       title <span class="op">=</span> <span class="st">"Number of \nobservations"</span>, pch <span class="op">=</span> <span class="fl">15</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/grid-1.png"><!-- --></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="other-polygons" class="section level3">
<h3 class="hasAnchor">
<a href="#other-polygons" class="anchor"></a>Other polygons</h3>
<p>Any other set of polygons could also be used to summarise, for example, the counties.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">counties</span> <span class="op">&lt;-</span> <span class="va">swe_wgs84</span><span class="op">$</span><span class="va">Counties</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">obs</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">counties</span><span class="op">)</span><span class="op">)</span>

<span class="co">## overlay the data with the counties</span>
<span class="va">listGrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span><span class="va">counties</span>, <span class="va">obs</span><span class="op">)</span>

<span class="va">ObsInCountyList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">listGrid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">listGrid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">ObsInCountyList</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">ObsInCountyList</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">obs</span><span class="op">[</span><span class="va">listGrid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">wNonEmpty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ObsInCountyList</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">wNonEmpty</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Observations don't overlap any grid cell."</span><span class="op">)</span>

<span class="co">## check nObs</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ObsInCountyList</span>, <span class="va">nrow</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="va">nObs</span> <span class="co"># some observations are not in the counties territory</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ObsInCountyList</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">counties</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>

<span class="co">## apply a summary over the grid</span>
<span class="va">nCells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ObsInCountyList</span><span class="op">)</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"nObs"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nCells</span><span class="op">)</span><span class="op">)</span>,
                  <span class="st">"nYears"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nCells</span><span class="op">)</span><span class="op">)</span>,
                  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">cols2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scientificName"</span>, <span class="st">"year"</span><span class="op">)</span>

<span class="va">dataRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ObsInCountyList</span><span class="op">[</span><span class="va">wNonEmpty</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="va">cols2use</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scientificName"</span>, <span class="st">"year"</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nObs"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="st">"scientificName"</span><span class="op">]</span><span class="op">)</span>,
           <span class="st">"nYears"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="st">"year"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>


<span class="va">dataRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">dataRes</span>, .id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>
<span class="va">res</span><span class="op">[</span><span class="va">wNonEmpty</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dataRes</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">res</span><span class="op">$</span><span class="va">nObs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">nObs</span><span class="op">)</span>

<span class="va">resSf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">counties</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">counties</span><span class="op">$</span><span class="va">LnNamn</span></code></pre></div>
<p>and again plotting as a map:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">palBW</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"navyblue"</span><span class="op">)</span>, 
                               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">nObs</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, 
                               na.color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>
<span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="fu">palBW</span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">nObs</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">swe_wgs84</span><span class="op">$</span><span class="va">Border</span>, border <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">counties</span><span class="op">)</span><span class="op">)</span>, 
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">counties</span><span class="op">$</span><span class="va">LnNamn</span><span class="op">)</span>, font <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">.5</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, 
       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">nObs</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
       col <span class="op">=</span> <span class="fu">palBW</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">resSf</span><span class="op">$</span><span class="va">nObs</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
       title <span class="op">=</span> <span class="st">"Number of \nobservations"</span>, pch <span class="op">=</span> <span class="fl">15</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/counties-1.png"><!-- --></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="add-the-county-name-to-each-observation" class="section level3">
<h3 class="hasAnchor">
<a href="#add-the-county-name-to-each-observation" class="anchor"></a>Add the county name to each observation</h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">countiesLab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">counties</span><span class="op">$</span><span class="va">LnNamn</span><span class="op">)</span>

<span class="co">## Add a column to the obs data.frame to hold the id of the overlapped polygon, </span>
<span class="co">## in this case, Län (county) and plot which observation didn't fall with any </span>
<span class="co">## territory.</span>
<span class="va">obs</span><span class="op">$</span><span class="va">overId</span> <span class="op">&lt;-</span> <span class="cn">NA</span> 

<span class="kw">for</span> <span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ObsInCountyList</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ObsInCountyList</span><span class="op">[[</span><span class="va">c</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">idsC</span> <span class="op">&lt;-</span> <span class="va">ObsInCountyList</span><span class="op">[[</span><span class="va">c</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">id</span>
    <span class="va">wObs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">idsC</span>, <span class="va">obs</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
    <span class="va">obs</span><span class="op">$</span><span class="va">overId</span><span class="op">[</span><span class="va">wObs</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">countiesLab</span><span class="op">[</span><span class="va">c</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">wObs</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">counties</span><span class="op">$</span><span class="va">geometry</span>, border <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">obs</span><span class="op">$</span><span class="va">geometry</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">obs</span><span class="op">$</span><span class="va">overId</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, 
     pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">.5</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-26-1.png"><!-- --></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>It is clear from this image that there are observations outside the territorial extent of the county but that may be within the counties water bodies or coastal areas.</p>
</div>
</div>
<div id="example-4-area-search-and-report--what-listed-species-exist-in-a-given-area" class="section level2">
<h2 class="hasAnchor">
<a href="#example-4-area-search-and-report--what-listed-species-exist-in-a-given-area" class="anchor"></a>Example 4: Area search and report. What listed species exist in a given area?</h2>
<p>Vector spatial layers (eg. polygons) can be imported in a number of different ways. biodiversitydata APIs take as search input polygons in the s.k. WKT <a href="https://www.geoapi.org/3.0/javadoc/org/opengis/referencing/doc-files/WKT.html">Well Known Text</a>. So the first step is to load a vector layer and transform it into a WKT string. First download a .zip file with different <a href="https://www.scb.se/hitta-statistik/regional-statistik-och-kartor/regionala-indelningar/digitala-granser">delimitation for Sweden</a> and move it somewhere you like in your computer. We recommend you move it into your working directory (<code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>). Extract the .zip file named KommunSweref99.zip. <!-- We use the ALA4R's caching mechanism here, but you could equally download this file directly. --></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"your/path/to/file"</span>, <span class="st">"Kommun_Sweref99TM_region.shp"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This will only work when you set a valid filepath, and will create an object of class SpatialPolygon. You could instead use the data we kindly provided in this package <code><a href="https://rdrr.io/r/utils/data.html">data("swe")</a></code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shape</span> <span class="op">&lt;-</span> <span class="va">swe</span><span class="op">$</span><span class="va">Municipalities</span>
<span class="co">## extract just the Municipality of Örebro</span>
<span class="va">shape</span> <span class="op">&lt;-</span> <span class="va">shape</span><span class="op">[</span><span class="va">shape</span><span class="op">$</span><span class="va">KnNamn</span> <span class="op">==</span> <span class="st">"Örebro"</span>, <span class="op">]</span></code></pre></div>
<p>We could create the WKT string using the <code>rgeos</code> library:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/">rgeos</a></span><span class="op">)</span>
<span class="va">wkt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/wkt-functions.html">writeWKT</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as_Spatial</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">shape</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Unfortunately, in this instance this gives a WKT string that is too long and won’t be accepted by the web service. Also, the shapefile we just got is projected in the coordinate system SWEREF99 TM, and the web service only accepts coordinates in a geodesic coordinate system WGS84. Instead, let’s construct the WKT string directly, which gives us a little more control over its format:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">shape</span>,
                      crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span>
<span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">shape</span><span class="op">)</span>

<span class="co">## extract the convex hull of the polygon to reduce the length of the WKT string</span>
<span class="va">shape_ch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_convex_hull</a></span><span class="op">(</span><span class="va">shape</span><span class="op">)</span>

<span class="co"># cast it as MULTIPOLYGON as this is what SBDIs API need</span>
<span class="co"># NOTE: as of today, the SBDI APIs will only work properly if the polygon is </span>
<span class="co"># submitted as a MULTIPOLYGON</span>
<span class="va">shape_ch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="va">shape_ch</span>, to <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span><span class="op">)</span>

<span class="co"># create WKT string</span>
<span class="va">wkt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_text.html">st_as_text</a></span><span class="op">(</span><span class="va">shape_ch</span><span class="op">)</span></code></pre></div>
<p>Now extract the species list in this polygon:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/species_list.html">species_list</a></span><span class="op">(</span>wkt<span class="op">=</span><span class="va">wkt</span>, fq<span class="op">=</span><span class="st">"rank:species"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">occurrenceCount</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">family</span>, <span class="va">occurrenceCount</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;                       species         family occurrenceCount
#&gt; 1     Acrocephalus scirpaceus Acrocephalidae           65263
#&gt; 2      Phylloscopus trochilus Phylloscopidae           44915
#&gt; 3  Acrocephalus schoenobaenus Acrocephalidae           39344
#&gt; 4        Emberiza schoeniclus    Emberizidae           39001
#&gt; 5         Cyanistes caeruleus        Paridae           33313
#&gt; 6                 Parus major        Paridae           26987
#&gt; 7               Cygnus cygnus       Anatidae           18873
#&gt; 8          Erithacus rubecula   Muscicapidae           18809
#&gt; 9                 Anser anser       Anatidae           18384
#&gt; 10           Sturnus vulgaris      Sturnidae           18363</code></pre>
</div>
<div id="example-5-community-composition-and-turnover" class="section level2">
<h2 class="hasAnchor">
<a href="#example-5-community-composition-and-turnover" class="anchor"></a>Example 5: Community composition and turnover</h2>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org">vegan</a></span><span class="op">)</span></code></pre></div>
<p>Define our area of interest as a transect running westwards from the Stockholm region, and download the occurrences of legumes (Fabaceae; a large family of flowering plants) in this area:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## A rough polygon around the Mällardalen</span>
<span class="va">wkt</span> <span class="op">&lt;-</span> <span class="st">"MULTIPOLYGON(((14.94 58.88, 14.94 59.69, 18.92 59.69, 18.92 58.88, 14.94 58.88)))"</span>

<span class="co">## define some environmental layers of interest [see sbdi_fields(fields_type = "occurrence")]</span>
<span class="co"># el10011 https://spatial.biodiversitydata.se/ws/layers/view/more/worldclim_bio_12</span>
<span class="co"># el10009 https://spatial.biodiversitydata.se/ws/layers/view/more/worldclim_bio_10</span>
<span class="va">env_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"el10009"</span>,<span class="st">"el10011"</span><span class="op">)</span> 

<span class="co">## Download the data.  We use the `occurrences()` function, adding environmental</span>
<span class="co">## data via the 'extra' parameter. </span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>fq<span class="op">=</span><span class="st">"family:Fabaceae"</span>, 
                 wkt<span class="op">=</span><span class="va">wkt</span>, qa<span class="op">=</span><span class="st">"none"</span>,
                 email<span class="op">=</span><span class="st">"sbdi4r-test@biodiversitydata.se"</span>,
                 download_reason_id<span class="op">=</span><span class="st">"testing"</span>, 
                 extra<span class="op">=</span><span class="va">env_layers</span><span class="op">)</span></code></pre></div>
<p>Convert this to a sites-by-species <code>data.frame</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="va">xgridded</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span>
    <span class="co">## discard genus- and higher-level records</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rank</span> <span class="op">%in%</span>
                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"subspecies"</span>, <span class="st">"variety"</span>, <span class="st">"form"</span>, <span class="st">"cultivar"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>longitude<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span><span class="op">/</span><span class="fl">4</span>, 
           latitude<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">latitude</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span><span class="op">/</span><span class="fl">4</span>, 
           worldClimMeanTemperatureOfWarmestQuarter <span class="op">=</span> <span class="va">worldClimMeanTemperatureOfWarmestQuarter</span> <span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">## average environmental vars within each bin</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">longitude</span>,<span class="va">latitude</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>worldClimAnnualPrecipitation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">worldClimAnnualPrecipitation</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,
           worldClimMeanTemperatureOfWarmestQuarter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">worldClimMeanTemperatureOfWarmestQuarter</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">## subset to vars of interest</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, <span class="va">species</span>, 
            <span class="va">worldClimAnnualPrecipitation</span>,
            <span class="va">worldClimMeanTemperatureOfWarmestQuarter</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">## take one row per cell per species (presence)</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">## calculate species richness</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>richness<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">## convert to wide format (sites by species)</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>present<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html">do</a></span><span class="op">(</span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">.</span>, key<span class="op">=</span><span class="va">species</span>, value<span class="op">=</span><span class="va">present</span>, fill<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## where a species was not present, it will have NA: convert these to 0</span>
<span class="va">sppcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">xgridded</span><span class="op">)</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span>, 
                     <span class="st">"worldClimAnnualPrecipitation"</span>, 
                     <span class="st">"worldClimMeanTemperatureOfWarmestQuarter"</span>,
                     <span class="st">"richness"</span><span class="op">)</span><span class="op">)</span>
<span class="va">xgridded</span> <span class="op">&lt;-</span> <span class="va">xgridded</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span><span class="op">(</span><span class="va">sppcols</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">z</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The end result:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xgridded</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt; # A tibble: 67 x 10</span>
<span class="co">#&gt;    longitude latitude worldClimAnnualPrecip~ worldClimMeanTemperatureO~ richness</span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt;                  &lt;dbl&gt;                      &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1      15       59                     631.                       15.3       40</span>
<span class="co">#&gt;  2      15       59.2                   648.                       15.4       36</span>
<span class="co">#&gt;  3      15       59.5                   672.                       15.2       38</span>
<span class="co">#&gt;  4      15       59.8                   682.                       15.2       11</span>
<span class="co">#&gt;  5      15.2     59                     625.                       15.5       40</span>
<span class="co">#&gt;  6      15.2     59.2                   633.                       15.8       57</span>
<span class="co">#&gt;  7      15.2     59.5                   655.                       15.6       30</span>
<span class="co">#&gt;  8      15.2     59.8                   661.                       15.6       16</span>
<span class="co">#&gt;  9      15.5     59                     615.                       15.6       31</span>
<span class="co">#&gt; 10      15.5     59.2                   625.                       15.8       43</span>
<span class="co">#&gt; # ... with 57 more rows, and 5 more variables: Anthyllis vulneraria &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Astragalus glycyphyllos &lt;dbl&gt;, Caragana arborescens &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Galega orientalis &lt;dbl&gt;, Genista tinctoria &lt;dbl&gt;</span></code></pre></div>
<p>Now we can start to examine the patterns in the data. Let’s plot richness as a function of longitude:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">xgridded</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">richness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longitud (º)"</span>, 
       y <span class="op">=</span> <span class="st">"Species richness"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">lims</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-38-1.png"><!-- --></p>
<p>Species richness as a function of environment:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">xgridded</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">worldClimMeanTemperatureOfWarmestQuarter</span> , 
                     <span class="va">worldClimAnnualPrecipitation</span>, 
                     colour<span class="op">=</span><span class="va">richness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Mean temperature of warmest quarter (ºC)"</span> , 
       y <span class="op">=</span> <span class="st">"Annual precipitation (mm)"</span>,
       colour <span class="op">=</span> <span class="st">"Species \nrichness"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_colour_distiller</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Spectral"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-39-1.png"><!-- --></p>
<p>It seem like there is higher species richness in hottest areas.</p>
<p>How does the community composition change along the transect? Use clustering:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org">vegan</a></span><span class="op">)</span>
<span class="co">## Bray-Curtis dissimilarity</span>
<span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">xgridded</span><span class="op">[</span>, <span class="va">sppcols</span><span class="op">]</span>, <span class="st">"bray"</span><span class="op">)</span>
<span class="co">## UPGMA clustering</span>
<span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">D</span>, method<span class="op">=</span><span class="st">"ave"</span><span class="op">)</span>
<span class="co">## plot the dendrogram</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-40-1.png"><!-- --></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## extract group labels at the 5-group level</span>
<span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">cl</span>, <span class="fl">5</span><span class="op">)</span>
<span class="co">## coalesce small (outlier) groups into a single catch-all group</span>
<span class="va">sing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">5</span><span class="op">)</span>
<span class="co"># grp[grp %in% sing] &lt;- 6 ## put these in a new combined group</span>
<span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">grp</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span><span class="op">==</span><span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="co">## renumber groups</span>
<span class="va">xgridded</span><span class="op">$</span><span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span>
<span class="co">## plot</span>
<span class="co">## colours for clusters</span>
<span class="va">thiscol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1f77b4"</span>, <span class="st">"#ff7f0e"</span>, <span class="st">"#2ca02c"</span>, <span class="st">"#d62728"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#8c564b"</span>, 
             <span class="st">"#e377c2"</span>, <span class="st">"#7f7f7f"</span>, <span class="st">"#bcbd22"</span>, <span class="st">"#17becf"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">xgridded</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, colour<span class="op">=</span><span class="va">grp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Longitude"</span>, y<span class="op">=</span><span class="st">"Latitude"</span>, colour<span class="op">=</span><span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">thiscol</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-40-2.png"><!-- --></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## or a slightly nicer map plot</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mapdata</span><span class="op">)</span>
<span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span><span class="op">(</span><span class="st">"worldHires"</span>, <span class="st">"Sweden"</span>, 
    xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14.5</span>, <span class="fl">20</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">58.8</span>, <span class="fl">59.95</span><span class="op">)</span>, 
    col<span class="op">=</span><span class="st">"gray90"</span>, fill<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">xgridded</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, 
                      pch<span class="op">=</span><span class="fl">21</span>, col<span class="op">=</span><span class="va">thiscol</span><span class="op">[</span><span class="va">grp</span><span class="op">]</span>, 
                      bg<span class="op">=</span><span class="va">thiscol</span><span class="op">[</span><span class="va">grp</span><span class="op">]</span>, cex<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/unnamed-chunk-40-3.png"><!-- --></p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-6-handlig-data-in-r-after-being-downloaded" class="section level2">
<h2 class="hasAnchor">
<a href="#example-6-handlig-data-in-r-after-being-downloaded" class="anchor"></a>Example 6: Handlig data in R after being downloaded</h2>
<p>R is pretty powerful when it comes to cleaning, selecting and filtering data</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon<span class="op">=</span><span class="st">"Callitriche cophocarpa"</span>,
                  fq <span class="op">=</span> <span class="st">"data_resource_uid:dr2"</span>,
                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#keep spatially unique data at 0.01 degrees (latitude and longitude)</span>
<span class="va">ll001</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span>, spatial <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>

<span class="co"># #keep only information for which fatal or "error" assertions do not exist</span>
<span class="va">nofat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">x</span>, remove.fatal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#keep only observations with a maximum spatial uncertainty of 50m</span>
<span class="va">SpatCert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">x</span>, max.spatial.uncertainty <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>

<span class="co"># quickly get some more info about the data:</span>
<span class="co"># no. observations (records)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>
<span class="co">#&gt; [1] 381</span>
 
<span class="co"># no. obs/year</span>
<span class="va">freq_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>

<span class="co"># no. obs across years:</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">freq_year</span>, bty <span class="op">=</span> <span class="st">"n"</span>, ylab<span class="op">=</span><span class="st">"Frequency"</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/Datahandling-1.png"><!-- --></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># or</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">year</span>, <span class="fl">20</span>, main <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></code></pre></div>
<p><img src="SBDI4R_files/figure-html/Datahandling-2.png"><!-- --></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Subsetting is done using '[ ]'</span>
<span class="va">x10yr</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">&gt;=</span><span class="fl">2010</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">&lt;=</span><span class="fl">2019</span><span class="op">)</span>,<span class="op">]</span> 
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">x10yr</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 2011 2015 2016 2017 </span>
<span class="co">#&gt;    3    1    1    4</span></code></pre></div>
</div>
<div id="example-7-aggregating-data-with-birds" class="section level2">
<h2 class="hasAnchor">
<a href="#example-7-aggregating-data-with-birds" class="anchor"></a>Example 7: Aggregating data with ‘BIRDS’</h2>
<p><a href="https://greensway.github.io/BIRDS/">BIRDS</a> is an R package that provides a set of tools for systematizing biodiversity data review in order to evaluate whether a set of species observation are fit-for-use and help take decisions upon its use in further analysis.<br>
In the following examples you will learn to aggregate statistics over space and time.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"Greensway/BIRDS"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/greensway/BIRDS">BIRDS</a></span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occurrences.html">occurrences</a></span><span class="op">(</span>taxon<span class="op">=</span><span class="st">"Callitriche cophocarpa"</span>,
                  fq <span class="op">=</span> <span class="st">"data_resource_uid:dr2"</span>,
                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">wNAcoor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">wNAcoor</span>,<span class="op">]</span>

<span class="co">### fill in NAs</span>
<span class="va">x</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">month</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">month</span><span class="op">)</span>
<span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">day</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">day</span><span class="op">)</span>

<span class="co">## Define the visit</span>
<span class="va">OB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BIRDS/man/organizeBirds.html">organiseBirds</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">wNAcoor</span>,<span class="op">]</span>, 
                    sppCol <span class="op">=</span> <span class="st">"scientificName"</span>, 
                    idCols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"locality"</span><span class="op">)</span>, 
                    timeCols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span>,<span class="st">"day"</span><span class="op">)</span>,
                    xyCols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">)</span>

<span class="va">SB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BIRDS/man/summarizeBirds.html">summariseBirds</a></span><span class="op">(</span><span class="va">OB</span>, grid <span class="op">=</span> <span class="va">Sweden_Grid_25km_Wgs84</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SBspatial</span> <span class="op">&lt;-</span> <span class="va">SB</span><span class="op">$</span><span class="va">spatial</span>
<span class="va">maxC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">SBspatial</span><span class="op">$</span><span class="va">nObs</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">palBW</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"navyblue"</span><span class="op">)</span>, 
                               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">maxC</span><span class="op">)</span>, 
                               na.color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>
<span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">4</span>,<span class="fl">0</span><span class="op">)</span>, mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">SBspatial</span><span class="op">$</span><span class="va">geometry</span>, col<span class="op">=</span><span class="fu">palBW</span><span class="op">(</span><span class="va">SBspatial</span><span class="op">$</span><span class="va">nObs</span><span class="op">)</span>,
     border <span class="op">=</span> <span class="st">"grey"</span>, main<span class="op">=</span><span class="st">"All years"</span><span class="op">)</span> <span class="co">## with palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, inset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.05</span><span class="op">)</span>,
       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">maxC</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
       col <span class="op">=</span> <span class="fu">palBW</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">maxC</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
       title <span class="op">=</span> <span class="st">"Number of \nobservations"</span>, pch <span class="op">=</span> <span class="fl">15</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span>

<span class="co">## or export other combinations, e.g. one map per observed year</span>
<span class="va">yearlySf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BIRDS/man/exportBirds.html">exportBirds</a></span><span class="op">(</span><span class="va">SB</span>, 
                        dimension <span class="op">=</span> <span class="st">"spatial"</span>, 
                        timeRes <span class="op">=</span> <span class="st">"yearly"</span>, 
                        variable <span class="op">=</span> <span class="st">"nObs"</span>, 
                        method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span>

<span class="va">maxC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">yearlySf</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">palBW</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"navyblue"</span><span class="op">)</span>, 
                               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">maxC</span><span class="op">)</span>, 
                               na.color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">yearlySf</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="fu">palBW</span><span class="op">(</span><span class="va">yearlySf</span><span class="op">$</span><span class="st">'1987'</span><span class="op">)</span>, 
     border <span class="op">=</span> <span class="st">"grey"</span>, main <span class="op">=</span> <span class="st">"1987"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, inset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.05</span><span class="op">)</span>,
       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">maxC</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
       col <span class="op">=</span> <span class="fu">palBW</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">maxC</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
       title <span class="op">=</span> <span class="st">"Number of \nobservations"</span>, pch <span class="op">=</span> <span class="fl">15</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">yearlySf</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="fu">palBW</span><span class="op">(</span><span class="va">yearlySf</span><span class="op">$</span><span class="st">'2017'</span><span class="op">)</span>, 
     border <span class="op">=</span> <span class="st">"grey"</span>, main <span class="op">=</span> <span class="st">"2017"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Perhaps one needs to save many summaries over each grid cell.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gridSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">SB</span><span class="op">$</span><span class="va">spatial</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">gridSummary</span>, <span class="st">"Callitriche_grid_summary.csv"</span><span class="op">)</span></code></pre></div>
<p>One could also think of aggregating the data temporally…</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># But the function exportBIrds() offers planty of combinations</span>
<span class="va">yearlyXTS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BIRDS/man/exportBirds.html">exportBirds</a></span><span class="op">(</span><span class="va">SB</span>, 
                         dimension <span class="op">=</span> <span class="st">"temporal"</span>, 
                         timeRes <span class="op">=</span> <span class="st">"yearly"</span>, 
                         variable <span class="op">=</span> <span class="st">"nObs"</span>,
                         method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">yearlyXTS</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, 
     grid.ticks.on <span class="op">=</span> <span class="st">"year"</span>,  
     grid.col <span class="op">=</span> <span class="st">"lightgrey"</span>,  
     main <span class="op">=</span> <span class="st">"Number of observations"</span><span class="op">)</span></code></pre></div>
<!-- ## Example 8: Getting species taxonomic data with DynTaxa -->
<!-- [dyntaxa](https://github.com/biodiversitydata/dyntaxa) is an R package that provides -->
<!-- a read-only interface with Dyntaxa - the taxonomic database of organisms in Sweden. -->
<!-- This package can be used to automate the following tasks: -->
<!--   - Taxonomic identifier from a taxonomic name and vice versa -->
<!--   - Taxonomic name from a vernacular (common) name and vice versa -->
<!--   - Taxonomic hierarchy/classification from identifier or name -->
<!--   - Taxonomic children of an identifier or name -->
<!--   - All taxa downstream to a certain rank from identifier or name -->
<!--   - Taxonomic synonyms from identifier or name -->
<!-- Here are some short and simple usage examples which shows you how to -->
<!-- download and access data from Dyntaxa for those tasks. -->
<!-- This package can only be installed from GitHub. -->
<!-- ```{r , eval=FALSE} -->
<!-- library(remotes) -->
<!-- install_github("biodiversitydata/dyntaxa", build_opts = c("--no-resave-data", "--no-manual"))   -->
<!-- ```   -->
<!-- Next, we copy and adapt some of the examples from the 'dyntaxa' webpage to complement  -->
<!-- the examples above.   -->
<!-- ```{r DynTaxa, message=FALSE, warning=FALSE} -->
<!-- library(dyntaxa) -->
<!-- # taxonomic name from taxonomic identifier -->
<!-- dyntaxa_name_from_id(5000001) -->
<!-- # taxonomic identifier from taxonomic name -->
<!-- key <- dyntaxa_id_from_name("Alces alces") -->
<!-- key -->
<!-- # the taxon key or identifier is often needed to retrieve taxonomic data -->
<!-- # taxonomic hierarchy/classification from identifier or name -->
<!-- dyntaxa_classification(key) -->
<!-- # taxa downstream from identifier or name -->
<!-- dyntaxa_downstream(dyntaxa_id_from_name("Cervidae")) -->
<!-- # taxonomic immediate children of an identifier or name -->
<!-- dyntaxa_children(dyntaxa_id_from_name("Carnivora")) -->
<!-- # taxa downstream of a specific taxon identifier  -->
<!-- # can be filtered at species level (or at other ranks) -->
<!-- dyntaxa_downstream(dyntaxa_id_from_name("Carnivora")) %>%  -->
<!--   filter(taxonRank == "species") -->
<!-- # search a fulltext index of Dyntaxa a vernacular name -->
<!-- dyntaxa_search_all("blåklocka") %>%  -->
<!--   select(taxonId, scientificName, vernacularName, title, creator) -->
<!-- # another example of a full text search  -->
<!-- dyntaxa_search_all("Thomas Karlssons Kärlväxtlista") %>% -->
<!--   filter(taxonRank == "family") -->
<!-- # what are synonyms for Sagedia zonata? -->
<!-- dyntaxa_synonyms(dyntaxa_id_from_name("Sagedia zonata")) -->
<!-- # more examples for synonyms -->
<!-- dyntaxa_search_all("scientificName:Phyllachora graminis") -->
<!-- dyntaxa_synonyms(dyntaxa_id_from_name("Phyllachora graminis")) -->
<!-- # does "Citronfjäril" / "Gonepteryx rhamni" have synonyms? -->
<!-- key <- dyntaxa_search_vernacular("citronfjäril")$taxonId -->
<!-- dyntaxa_name_from_id(key) -->
<!-- dyntaxa_synonyms(key) -->
<!-- ``` -->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Debora Arlt, Alejandro Ruete, Anton Hammarström, Marcus Lindh.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
